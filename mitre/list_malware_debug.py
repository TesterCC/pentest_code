from stix2 import MemoryStore, Filter
import json
import pandas as pds

# git clone cti
CTI_PATH = "/Users/seccodecat/Work/ATT&CK/cti"
ICS_PATH = CTI_PATH + "/ics-attack/ics-attack.json"
ENTERPRISE_PATH = CTI_PATH + "/enterprise-attack/enterprise-attack.json"
MOBILE_PATH = CTI_PATH + "/mobile-attack/mobile-attack.json"

COLUMNS = ["name", "x_mitre_aliases", "type",
           "description", "external_references"]

with open(ICS_PATH) as f:
    ics = json.load(f)

ms = MemoryStore(stix_data=ics["objects"])
mal = ms.query([Filter("type", "=", "malware")])
df_ics = pds.DataFrame(mal)
df_ics = df_ics[COLUMNS]

with open(ENTERPRISE_PATH) as f:
    enterprise = json.load(f)
ms = MemoryStore(stix_data=enterprise["objects"])
mal = ms.query([Filter("type", "=", "malware")])
df_enterprise = pds.DataFrame(mal)
df_enterprise = df_enterprise[COLUMNS]

with open(MOBILE_PATH) as f:
    mobile = json.load(f)
ms = MemoryStore(stix_data=mobile["objects"])
mal = ms.query([Filter("type", "=", "malware")])
df_mobile = pds.DataFrame(mal)
df_mobile = df_mobile[COLUMNS]

result = pds.concat([df_ics, df_enterprise, df_mobile])
result.to_excel("all_malware.xlsx")
df_ics.to_excel("ics_malware.xlsx")
df_enterprise.to_excel("enterprise_malware.xlsx")
df_mobile.to_excel("mobile_malware.xlsx")

# -*- coding: utf-8 -*-
# @Time    : 2022/5/16
# @Author  : SecCodeCat

from stix2 import MemoryStore, Filter
import json

"""
ref: 
https://oasis-open.github.io/cti-documentation/stix/intro
https://docs.oasis-open.org/cti/stix/v2.1/cs01/stix-v2.1-cs01.html
https://zhuanlan.zhihu.com/p/311145611
"""

# git clone cti
CTI_PATH = "/Users/seccodecat/Work/ATT&CK/attack-stix-data"
ICS_PATH = CTI_PATH + "/ics-attack/ics-attack.json"
ENTERPRISE_PATH = CTI_PATH + "/enterprise-attack/enterprise-attack.json"
MOBILE_PATH = CTI_PATH + "/mobile-attack/mobile-attack.json"

with open(ICS_PATH) as f:
    ics = json.load(f)

with open(ENTERPRISE_PATH) as f:
    enterprise = json.load(f)

with open(MOBILE_PATH) as f:
    mobile = json.load(f)


def get_objects_types(stix_data):
    # ms = MemoryStore(stix_data=stix_data["objects"])
    # mal = ms.query([Filter("type", "=", "malware")])

    type_key = []
    for i in stix_data["objects"]:
        if i.get("type") not in type_key:
            type_key.append(i.get("type"))

    print(f"have types: {len(type_key)},\ntype key: {type_key}")


if __name__ == '__main__':
    get_objects_types(ics)
    get_objects_types(enterprise)
    get_objects_types(mobile)

#!/usr/bin/env python
# -*- coding:utf-8 -*-
__author__ = 'MFC'
__time__ = '2020/6/15 20:59'

import sys
import socket

"""
8-2 使用Python实现端口扫描
"""

socket.setdefaulttimeout(0.5)


def scan(ip, port):
    print(f'[+] Server {ip} , Port: {port} is scanning ')
    try:
        port = int(port)
        # socket.AF_INET：服务器间通信         socket.SOCK_STREAM：流式socket for TCP
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        res = sock.connect_ex((ip, port))    # socket的connect方法把相关的发包和判断包的动作都做了
        if res == 0:
            print('Result: OPEN')
        else:
            print('Result: CLOSE')
        sock.close()
    except socket.gaierror:
        print('Hostname can not be resolved. Exiting...')
    except socket.error:
        print("Can not connect to the server")


if __name__ == '__main__':
    ip = sys.argv[1]
    port = sys.argv[2]
    scan(ip, port)

# 要在命令行执行，执行语句
# python tcp_port_scan.py 220.181.38.148 22
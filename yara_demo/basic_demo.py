import yara

rule_path = r"E:\pentest_tools\yara_test\rule\python.yara"
sample_path = r"E:\pentest_tools\yara_test\sample\mc_backend_api.py"

# a basic yara-python demo
# pip3 install yara-python -i https://pypi.tuna.tsinghua.edu.cn/simple
# official docs: https://yara.readthedocs.io/en/stable/yarapython.html

# 加载YARA规则文件
rules = yara.compile(rule_path)

# 指定要分析的文件路径
file_path = sample_path

# 打开文件并读取内容
with open(file_path, 'rb') as file:
    file_data = file.read()

# 在文件数据上应用规则
matches = rules.match(data=file_data)

# 打印匹配的规则信息
for match in matches:
    print(f"Rule: {match.rule}")
    print(f"Namespace: {match.namespace}")
    print(f"Tags: {match.tags}")
    print(f"Meta: {match.meta}")
    print(f"Strings: {match.strings}")
    print(f"-----------")